<!doctype html>

<html lang="en">

<head>
  <meta charset="utf-8">

  <title>Luas</title>
  <meta name="author" content="Fabrice Lamant">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css"
    integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE=" crossorigin="anonymous" />
  <style>
    div {
      text-align: center;
    }

    table {
      width: 100%;
    }

    td {
      font-family: 'Courier New', Courier, monospace;
    }
  </style>
</head>

<body>
  <div class="container-fluid">
    <div class="row">
      <div class="col-lg-3">
        <h2>Spencer Dock</h2>
        <div id="spencer-dock" stop-id="74" stop-direction="1">
        </div>
      </div>
      <div class="col-lg-3">
        <h2>Marlborough</h2>
        <div id="marlborough" stop-id="2839" stop-direction="1">
        </div>
      </div>
      <div class="col-lg-3">
        <h2>Abbey street</h2>
        <div id="abbey-street" stop-id="80" stop-direction="0">
        </div>
      </div>
      <div class="col-lg-3">
        <h2>St Stephen's Green</h2>
        <div id="st-stephens-green" stop-id="104" stop-direction="0">
        </div>
      </div>
    </div>
  </div>

  <script src="./utils.js"></script>
  <script>
    // const symbol = getQueryParameterByName('symbol') || 'SSTK';
    // const url = `https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${symbol}&apikey=YMI7P74NUFU1UJW5`;
    // loadUrl(url, (result) => {
    //   const stock = JSON.parse(result);
    //   const shares = parseInt(getQueryParameterByName('shares') || 1);
    //   let data = [];
    //   Object.entries(stock["Time Series (Daily)"])
    //     .forEach(([date, values]) => {
    //       const value = values['4. close'] * shares;
    //       data.push({ t: moment(date).toDate(), y: value.toFixed(2) });
    //     });
    //   data = data.sort((a, b) => { return a.t.getTime() - b.t.getTime(); });
    //   var ctx = document.getElementById('stock').getContext('2d');
    //   new Chart(ctx, {
    //     type: 'line',
    //     data: { datasets: [{ label: 'stock', data }] },
    //     options: { scales: { xAxes: [{ type: 'time', time: { unit: 'day', distribution: 'series' } }] } },
    //   });
    // });
    // https://luas.ie/luas-pid.html?stop=74
    const parser = new DOMParser();

    const loadLuas = (id) => {
      const stop = getElement(id);
      const stopId = stop.getAttribute('stop-id');
      const stopDirection = stop.getAttribute('stop-direction');
      loadUrl(`https://luas.ie/luas-pid.html?stop=${stopId}`, result => {
        const doc = parser.parseFromString(result, "text/html");
        stop.innerHTML = doc.getElementsByClassName('stop-table')[stopDirection].innerHTML;
      });
    };

    loadLuas('spencer-dock');
    loadLuas('marlborough');
    loadLuas('abbey-street');
    loadLuas('st-stephens-green');
  </script>
</body>

</html>